

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8. Python çˆ¬è™«å…¥é—¨ &#8212; Python æ•°æ®ç§‘å­¦</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "https://github.com/RobinChen121/book-Python-Data-Science");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ğŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'introduction-to-crawler';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. çº¿æ€§å›å½’" href="line-regression.html" />
    <link rel="prev" title="7. Python ç”»å›¾" href="draw-pictures.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    å‰è¨€
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Python åŸºç¡€</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="A-first-look-of-Python.html">1. åˆè¯† Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-data-type.html">2. Python çš„å¸¸ç”¨æ•°æ®ç±»å‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="define-function.html">3. Python ç¼–å†™å‡½æ•°</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction-to-numpy.html">4. Numpy ç®€ä»‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction-to-pandas.html">5. Pandas å…¥é—¨</a></li>
<li class="toctree-l1"><a class="reference internal" href="print-read-files.html">6. Python è¾“å‡ºï¼Œè¯»å†™æ–‡ä»¶</a></li>
<li class="toctree-l1"><a class="reference internal" href="draw-pictures.html">7. Python ç”»å›¾</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python å®è·µ</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Python çˆ¬è™«å…¥é—¨</a></li>
<li class="toctree-l1"><a class="reference internal" href="line-regression.html">9. çº¿æ€§å›å½’</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/RobinChen121/book-Python-Data-Science" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/RobinChen121/book-Python-Data-Science/issues/new?title=Issue%20on%20page%20%2Fintroduction-to-crawler.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/introduction-to-crawler.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Python çˆ¬è™«å…¥é—¨</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requests">8.1. <code class="docutils literal notranslate"><span class="pre">requests</span></code> åº“</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beautifulsoup4">8.2. <code class="docutils literal notranslate"><span class="pre">beautifulsoup4</span></code>åº“</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">8.3. çˆ¬è™«å®ä¾‹ 1ï¼šæŠ“å°è¯´</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#top-250">8.4. çˆ¬è™«å®ä¾‹ 2ï¼šæŠ“è±†ç“£ top 250 çš„ç”µå½±ä¿¡æ¯</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">8.5. ç»ƒä¹ </a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="python">
<h1><span class="section-number">8. </span>Python çˆ¬è™«å…¥é—¨<a class="headerlink" href="#python" title="Permalink to this headline">#</a></h1>
<p>Python çš„çˆ¬è™«åŠŸèƒ½ä½¿å¾—ç¨‹åºå‘˜å¯ä»¥å¿«é€ŸæŠ“å–å¹¶åˆ†æç½‘é¡µä¸­çš„ä¿¡æ¯ï¼Œå®ƒå®è´¨ä¸Šæ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®ç½‘é¡µã€‚æœ¬ç« ä¸»è¦å¸¸ç”¨çš„ä¸¤ä¸ªçˆ¬è™«ç›¸å…³çš„åº“<code class="docutils literal notranslate"><span class="pre">requests</span></code>ï¼Œ<code class="docutils literal notranslate"><span class="pre">beautifulsoup4</span></code>ã€‚è‹¥è¦æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»ç­‰ï¼Œè¦ç”¨åˆ°<code class="docutils literal notranslate"><span class="pre">selenium</span></code> åº“ï¼Œé™äºç¯‡å¹…é™åˆ¶ï¼Œæœ¬ç« ä¸å†ä»‹ç»ï¼Œå…·ä½“å¯ä»¥æŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚</p>
<section id="requests">
<h2><span class="section-number">8.1. </span><code class="docutils literal notranslate"><span class="pre">requests</span></code> åº“<a class="headerlink" href="#requests" title="Permalink to this headline">#</a></h2>
<p>æ¯ä¸ªç½‘é¡µéƒ½æœ‰æºä»£ç ï¼Œå¯ä»¥é€šè¿‡é¼ æ ‡å•å‡»å³é”®æŸ¥çœ‹ç½‘é¡µæºä»£ç ã€‚ç½‘é¡µä¸­çš„å¾ˆå¤šä¿¡æ¯éƒ½åœ¨æºä»£ç é‡Œé¢ï¼Œ<code class="docutils literal notranslate"><span class="pre">requests</span></code> æ˜¯ä¸€ä¸ªè®¿é—®ç½‘é¡µæºä»£ç çš„åº“ã€‚ä¸€èˆ¬é€šè¿‡ get å‡½æ•°è®¿é—®ç½‘é¡µï¼Œå¦å¤–ä¸€ä¸ªå¸¸ç”¨æ¥è®¿é—®ç½‘é¡µçš„å‡½æ•°æ˜¯ postï¼Œä¸ get å‡½æ•°çš„åŒºåˆ«åœ¨äº post èƒ½å¤Ÿä¼ é€’è¡¨æ ¼æˆ–æ–‡ä»¶åˆ°ç½‘é¡µæ‰€åœ¨æœåŠ¡å™¨ä¸Šã€‚</p>
<table>   
    <tr style="border-top:solid; border-bottom:solid">
            <th colspan=2 style="text-align:center">get(url, [timeout], [headers], [proxies], **kwargs)</th>
    </tr>
    <tr>
        <td style="text-align:left">url</td>
        <td style="text-align:left">ç½‘é¡µé“¾æ¥</td>
    </tr>
    <tr>
        <td style="text-align:left">timeout</td>
        <td style="text-align:left">å¯é€‰å‚æ•°ï¼Œè¯·æ±‚ç½‘é¡µçš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸ºç§’</td>
    </tr>
    <tr>
        <td style="text-align:left">headers</td>
        <td style="text-align:left">å¯é€‰å‚æ•°ï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨è®¾ç½®</td>
    </tr>
    <tr>
        <td style="text-align:left">proxies</td>
        <td style="text-align:left">å¯é€‰å‚æ•°ï¼Œä»£ç†æœåŠ¡å™¨è®¾ç½®</td>
    </tr>
    <tr style="border-bottom:solid">
        <td style="text-align:left">**kwargs</td>
        <td style="text-align:left">å…¶ä»–å‚æ•°</td>
    </tr>
</table>
<br /><p>get æˆ– post å‡½æ•°è¿”å›ä¸€ä¸ª Resoponse å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…æ‹¬ä»¥ä¸‹å¸¸ç”¨çš„å±æ€§æˆ–å‡½æ•°ã€‚</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-left head"><p>å±æ€§æˆ–å‡½æ•°</p></th>
<th class="text-left head"><p>æè¿°</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>status_code</p></td>
<td class="text-left"><p>ç½‘é¡µè¯·æ±‚çš„è¿”å›çŠ¶æ€ï¼Œ200 è¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œ404 è¡¨ç¤ºè¿æ¥å¤±è´¥</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>text</p></td>
<td class="text-left"><p>å“åº”ç½‘é¡µçš„å­—ç¬¦ä¸²å†…å®¹</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>encoding</p></td>
<td class="text-left"><p>å“åº”ç½‘é¡µçš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥æ›´æ”¹</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>content</p></td>
<td class="text-left"><p>ç›¸åº”ç½‘é¡µçš„å­—èŠ‚å½¢å¼å†…å®¹ï¼Œä¾‹å¦‚å›¾ç‰‡æˆ– pdf æ–‡ä»¶ç­‰</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>raise_for_status()</p></td>
<td class="text-left"><p>å¦‚æœç½‘é¡µè®¿é—®ä¸æˆåŠŸï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œä¸€èˆ¬ç»“åˆ try-except è¯­å¥ä½¿ç”¨</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>json()</p></td>
<td class="text-left"><p>è¯¥å‡½æ•°å¯ä»¥è§£æç½‘é¡µå†…å®¹ä¸­ JSON æ ¼å¼çš„æ•°æ®</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">status_code</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
</div>
</div>
<div class="highlight-{code-block}python notranslate"><div class="highlight"><pre><span></span>r.text # ç»“æœçœç•¥
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">encoding</span>  <span class="c1"># è‹¥ä¸º ISO-8859-1 åˆ™ä¸­æ–‡ä¸ºä¹±ç </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;utf-8&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span> <span class="c1"># æ— è®ºç½‘é¡µåŸå†…å®¹æ˜¯ä»€ä¹ˆç¼–ç ï¼Œéƒ½æ”¹æˆ utf-8 ç¼–ç </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="beautifulsoup4">
<h2><span class="section-number">8.2. </span><code class="docutils literal notranslate"><span class="pre">beautifulsoup4</span></code>åº“<a class="headerlink" href="#beautifulsoup4" title="Permalink to this headline">#</a></h2>
<p>ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">requests</span></code>è·å–çš„ç½‘é¡µæºä»£ç ä¸€èˆ¬éå¸¸å¤æ‚ï¼Œä¸ä»…åŒ…æ‹¬å¸¸è§„å†…å®¹ï¼Œè¿˜åŒ…æ‹¬å¾ˆå¤šå®šä¹‰é¡µé¢æ ¼å¼çš„ä»£ç ã€‚<code class="docutils literal notranslate"><span class="pre">beautifulsoup4</span></code>åº“æä¾›äº†å¤§é‡çš„å±æ€§æˆ–å‡½æ•°ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°å°†ç½‘é¡µï¼ˆhtmlï¼‰ä¸åŒæ ‡ç­¾ï¼ˆtagï¼‰ä¸­çš„å†…å®¹æå–å‡ºæ¥ã€‚å¸¸ç”¨çš„å±æ€§æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-left head"><p>å±æ€§</p></th>
<th class="text-left head"><p>æè¿°</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>head</p></td>
<td class="text-left"><p>ç½‘é¡µæºä»£ç ä¸­çš„ &lt;head&gt; æ ‡ç­¾å†…å®¹</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>title</p></td>
<td class="text-left"><p>ç½‘é¡µæºä»£ç ä¸­çš„ &lt;title&gt; æ ‡ç­¾å†…å®¹</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>body</p></td>
<td class="text-left"><p>ç½‘é¡µæºä»£ç ä¸­çš„ &lt;body&gt; æ ‡ç­¾å†…å®¹</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>p</p></td>
<td class="text-left"><p>ç½‘é¡µæºä»£ç ä¸­çš„ç¬¬ä¸€ä¸ª &lt;p&gt; æ ‡ç­¾å†…å®¹</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>a</p></td>
<td class="text-left"><p>ç½‘é¡µæºä»£ç ä¸­çš„ç¬¬ä¸€ä¸ª &lt;a&gt; æ ‡ç­¾å†…å®¹</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>div</p></td>
<td class="text-left"><p>ç½‘é¡µæºä»£ç ä¸­çš„ç¬¬ä¸€ä¸ª &lt;div&gt; æ ‡ç­¾å†…å®¹</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>script</p></td>
<td class="text-left"><p>ç½‘é¡µæºä»£ç ä¸­çš„ç¬¬ä¸€ä¸ª &lt;script&gt; æ ‡ç­¾å†…å®¹</p></td>
</tr>
</tbody>
</table>
<div class="tip admonition">
<p class="admonition-title">tips</p>
<ul class="simple">
<li><p>ç½‘é¡µä¸­çš„å†…å®¹ä¸€èˆ¬åœ¨ç½‘é¡µæºä»£ç çš„å„ä¸ªæ ‡ç­¾é‡Œ</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="c1"># å°†ç½‘é¡µå†…å®¹ä¼ é€’ç»™ BeautifulSoup æå–</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup</span><span class="o">.</span><span class="n">title</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;title&gt;ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“&lt;/title&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup</span><span class="o">.</span><span class="n">p</span> <span class="c1"># html è¯­è¨€ä¸­ p æ ‡ç­¾è¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬æ®µè½</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;p class=&quot;lh&quot;&gt;&lt;a class=&quot;text-color&quot; href=&quot;//home.baidu.com&quot; target=&quot;_blank&quot;&gt;å…³äºç™¾åº¦&lt;/a&gt;&lt;/p&gt;
</pre></div>
</div>
</div>
</div>
<p>ä¸Šé¢çš„è¿™äº›æ ‡ç­¾å¯¹è±¡è¿˜æœ‰è‡ªå·±çš„å±æ€§å¯ä»¥è®¿é—®æ›´å…·ä½“çš„å†…å®¹ã€‚</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-left head"><p>æ ‡ç­¾å±æ€§</p></th>
<th class="text-left head"><p>æè¿°</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>name</p></td>
<td class="text-left"><p>æ ‡ç­¾åå­—ï¼Œä¾‹å¦‚ aï¼Œpï¼Œdivç­‰</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>attrs</p></td>
<td class="text-left"><p>æ ‡ç­¾çš„å…·ä½“å±æ€§</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>contents</p></td>
<td class="text-left"><p>ç¬¬ä¸€ä¸ªè¯¥æ ‡ç­¾ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼Œä¸ºåˆ—è¡¨å½¢å¼</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>string</p></td>
<td class="text-left"><p>ç¬¬ä¸€ä¸ªè¯¥æ ‡ç­¾æˆ–å­æ ‡ç­¾ä¸‹çš„æ–‡æœ¬å†…å®¹ï¼Œè‹¥æ ‡ç­¾ä¸­æ²¡æœ‰å†…å®¹æˆ–è€…è¶…è¿‡ä¸€å±‚çš„å­æ ‡ç­¾ï¼Œåˆ™è¿”å› None</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>text</p></td>
<td class="text-left"><p>ç¬¬ä¸€ä¸ªè¯¥æ ‡ç­¾ä¸‹ï¼ˆåŒ…æ‹¬å­æ ‡ç­¾ï¼‰çš„æ‰€æœ‰æ–‡æœ¬å†…å®¹ï¼Œè‹¥æ²¡æœ‰å†…å®¹åˆ™è¿”å›ç©ºæ–‡æœ¬</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;p&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">attrs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;class&#39;: [&#39;lh&#39;]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">contents</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;a class=&quot;text-color&quot; href=&quot;//home.baidu.com&quot; target=&quot;_blank&quot;&gt;å…³äºç™¾åº¦&lt;/a&gt;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">string</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;å…³äºç™¾åº¦&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;å…³äºç™¾åº¦&#39;
</pre></div>
</div>
</div>
</div>
<p>å°†æŒ–ç½‘é¡µå†…å®¹ä¼ é€’ç»™BeautifulSoup æå–æ—¶ï¼Œè¿˜å¯ä»¥æŒ‡å®šè§£æå™¨ï¼Œä¾‹å¦‚ â€˜html.parserâ€™, â€˜lxmlâ€™, â€˜xmlâ€™, â€˜html5libâ€™ã€‚è¿™äº›è§£æå™¨å„æœ‰åˆ©å¼Šï¼Œå…¶ä¸­ â€˜lxmlâ€™ è§£æé€Ÿåº¦æœ€å¿«ã€‚</p>
<p>å‡å¦‚æœ‰ä¸‹é¢çš„ html ä»£ç ï¼š</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">html_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Hello, BeautifulSoup!&lt;/h1&gt;</span>
<span class="s2">        &lt;ul&gt;</span>
<span class="s2">            &lt;li&gt;&lt;a class = &quot;c1&quot; href=&quot;http://example1.com&quot;&gt;Link 1&lt;/a&gt;&lt;/li&gt;</span>
<span class="s2">            &lt;li&gt;&lt;a class = &quot;c2&quot; href=&quot;http://example2.org&quot;&gt;Link 2&lt;/a&gt;&lt;/li&gt;</span>
<span class="s2">        &lt;/ul&gt;</span>
<span class="s2">        &lt;div&gt;</span>
<span class="s2">        &lt;p&gt;text1&lt;/p&gt; &lt;p&gt;text2&lt;/p&gt;</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_doc</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span> <span class="c1"># æˆ–è€… soup2 = BeautifulSoup(html_doc, features = &#39;lxml&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">ul</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\nLink 1\nLink 2\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">soup2</span><span class="o">.</span><span class="n">ul</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="c1"># æ–‡æœ¬å†…å®¹åµŒå¥—è¶…è¿‡ä¸€å±‚ï¼Œè¿”å› None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NoneType
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">li</span><span class="o">.</span><span class="n">contents</span> <span class="c1"># html è¯­è¨€ä¸­ a æ ‡ç­¾æ˜¯è¶…é“¾æ¥ï¼Œul ä¸ li æ ‡ç­¾è¡¨ç¤ºä¸€ä¸ªæ— åºåˆ—è¡¨</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;a class=&quot;c1&quot; href=&quot;http://example1.com&quot;&gt;Link 1&lt;/a&gt;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">ul</span><span class="o">.</span><span class="n">li</span><span class="o">.</span><span class="n">text</span> <span class="c1"># æ ‡ç­¾é€šè¿‡é€—ç‚¹å¥—å­æ ‡ç­¾</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Link 1&#39;
</pre></div>
</div>
</div>
</div>
<p>å½“éœ€è¦åˆ—å‡ºåŒä¸€ç±»æ ‡ç­¾å¯¹åº”çš„æ‰€æœ‰å†…å®¹æ—¶ï¼Œéœ€è¦ç”¨åˆ° BeautifulSoup ä¸­çš„ findall() å‡½æ•°ã€‚</p>
<table>   
    <tr style="border-top:solid; border-bottom:solid">
            <th colspan=2 style="text-align:center">find_all([name], [attrs], [string], [limit], **kwargs)</th>
    </tr>
    <tr>
        <td style="text-align:left">name</td>
        <td style="text-align:left">æ ‡ç­¾åå­—</td>
    </tr>
    <tr>
        <td style="text-align:left">attrs</td>
        <td style="text-align:left">æŒ‰ç…§æ ‡ç­¾çš„å…·ä½“å±æ€§æ£€ç´¢, é‡‡ç”¨ class_= å½¢å¼æˆ– JSON æ ¼å¼ç­‰</td>
    </tr>
    <tr>
        <td style="text-align:left">string</td>
        <td style="text-align:left">æŒ‰ç…§å…³é”®å­—æ£€ç´¢ï¼Œé‡‡ç”¨ string= å½¢å¼ï¼Œè¿”å›ä¸å…³é”®å­—å®Œå…¨åŒ¹é…çš„å­—ç¬¦ä¸²</td>
    </tr>
    <tr>
        <td style="text-align:left">limit</td>
        <td style="text-align:left">è¿”å›ç»“æœçš„ä¸ªæ•°ï¼Œé»˜è®¤è¿”å›æ‰€æœ‰ç»“æœ</td>
    </tr>
    <tr style="border-bottom:solid">
        <td style="text-align:left">**kwargs</td>
        <td style="text-align:left">å…¶ä»–å‚æ•°</td>
    </tr>
</table>
<br /><p>è¿˜æœ‰ä¸€ä¸ªå‡½æ•°<code class="docutils literal notranslate"><span class="pre">find()</span></code>ï¼Œä¸<code class="docutils literal notranslate"><span class="pre">findall()</span></code>çš„åŒºåˆ«åœ¨äº<code class="docutils literal notranslate"><span class="pre">find()</span></code>åªå¯»æ‰¾ç¬¬ä¸€ä¸ªå¯¹åº”æ ‡ç­¾çš„å†…å®¹ã€‚è¿˜æœ‰ä¸€ä¸ªå‡½æ•°<code class="docutils literal notranslate"><span class="pre">find_next()</span></code>ï¼Œå¯ä»¥æŸ¥æ‰¾æ ‡ç­¾çš„ä¸‹ä¸€ä¸ªæ ‡ç­¾ã€‚</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="c1"># æ£€ç´¢å‡ºç½‘é¡µä¸­æ‰€æœ‰çš„ a æ ‡ç­¾</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;a class=&quot;c1&quot; href=&quot;http://example1.com&quot;&gt;Link 1&lt;/a&gt;,
 &lt;a class=&quot;c2&quot; href=&quot;http://example2.org&quot;&gt;Link 2&lt;/a&gt;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">class_</span> <span class="o">=</span> <span class="s1">&#39;c1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;a class=&quot;c1&quot; href=&quot;http://example1.com&quot;&gt;Link 1&lt;/a&gt;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">class_</span> <span class="o">=</span> <span class="s1">&#39;c1&#39;</span><span class="p">)</span> <span class="c1"># å‚æ•°ä¸­å¯ä»¥æ²¡æœ‰æ ‡ç­¾åå­—</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;a class=&quot;c1&quot; href=&quot;http://example1.com&quot;&gt;Link 1&lt;/a&gt;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;Link&#39;</span><span class="p">)</span> <span class="c1"># å…³é”®è¯æ£€ç´¢</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span> <span class="c1"># å¯¼å…¥æ­£åˆ™è¡¨è¾¾å¼åº“</span>

<span class="n">soup2</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;Link&#39;</span><span class="p">))</span> <span class="c1"># é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å°†æ‰€æœ‰åŒ…å« Link çš„å­—ç¬¦ä¸²éƒ½æ£€ç´¢å‡ºæ¥</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Link 1&#39;, &#39;Link 2&#39;]
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç”¨æ¥æè¿°å­—ç¬¦ä¸²çš„ä¸€ç§è¡¨è¾¾å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾è§„åˆ™ï¼Œåªè¦å­—ç¬¦ä¸²æ»¡è¶³è¿™ä¸ªè§„åˆ™ï¼Œå°±ç®—åˆ™åŒ¹é…ã€‚å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²ç»“åˆç¬¦å· .*+? ç­‰å®šä¹‰å¤šç§è¡¨è¾¾è§„åˆ™ï¼Œå…·ä½“å¯ä»¥è¿›ä¸€æ­¥æŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚</p>
</div>
<p>BeautifulSoup å¦å¤–ä¸€ä¸ªå¸¸ç”¨çš„è·å–æ–‡æœ¬å†…å®¹çš„å‡½æ•°ä¸º<code class="docutils literal notranslate"><span class="pre">get_text</span></code>ã€‚ä¸ç›´æ¥ä½¿ç”¨æ ‡ç­¾çš„å±æ€§ text ç›¸æ¯”ï¼Œ<code class="docutils literal notranslate"><span class="pre">get_text</span></code> æ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°å®ç°æ–‡æœ¬æ¢è¡Œã€‚å®ƒçš„ä¸€èˆ¬ç”¨æ³•ä¸ºï¼š</p>
<table>   
    <tr style="border-top:solid; border-bottom:solid">
            <th colspan=2 style="text-align:center">get_text([separator=''], [strip=False], **kwargs)</th>
    </tr>
    <tr>
        <td style="text-align:left">separator</td>
        <td style="text-align:left">å„æ ‡ç­¾ä¸‹æ–‡æœ¬çš„åˆ†éš”ç¬¦</td>
    </tr>
    <tr>
        <td style="text-align:left">strip</td>
        <td style="text-align:left">æ˜¯å¦å»æ‰å„æ ‡ç­¾æ–‡æœ¬çš„å‰åç©ºæ ¼</td>
    </tr>
    <tr style="border-bottom:solid">
        <td style="text-align:left">**kwargs</td>
        <td style="text-align:left">å…¶ä»–å‚æ•°</td>
    </tr>
</table>
<br /><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">text</span> <span class="c1"># html è¯­è¨€ä¸­ div æ ‡ç­¾è¡¨ç¤ºç½‘é¡µä¸­çš„ä¸€ä¸ªåŒºåŸŸ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\ntext1 text2\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\ntext1 text2\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">separator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\n\ntext1\n \ntext2\n\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">separator</span> <span class="o">=</span> <span class="s1">&#39;**&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\n**text1** **text2**\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soup2</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">strip</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;text1text2&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2><span class="section-number">8.3. </span>çˆ¬è™«å®ä¾‹ 1ï¼šæŠ“å°è¯´<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h2>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¸¾ä¾‹å¦‚ä½•ç”¨çˆ¬è™«æŠ“å–ç½‘ä¸Šçš„ã€Šä¸‰å›½æ¼”ä¹‰ã€‹å°è¯´ï¼Œå¹¶å°†æ¯å›çš„å†…å®¹ä¸‹è½½åˆ°ç”µè„‘é‡Œã€‚</p>
<p>é¦–å…ˆï¼Œæ‰¾åˆ°ä¸€ä¸ªåŒ…å«ã€Šä¸‰å›½æ¼”ä¹‰ã€‹å°è¯´çš„ç½‘ç«™ï¼Œæœ¬ä¾‹ä¸­ï¼Œä½¿ç”¨äº†å¤è¯—æ–‡ç½‘ï¼šhttps://so.gushiwen.cn/guwen/book_46653FD803893E4F7F702BCF1F7CCE17.aspx</p>
<p>ç„¶åï¼Œåœ¨ç½‘é¡µçš„ç©ºç™½å¤„ï¼Œå•å‡»é¼ æ ‡å³é”®ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼š</p>
<p><img alt="san_guo1" src="_images/san_guo1.png" /></p>
<p>ç½‘é¡µçš„æºä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p>
<p><img alt="sanguo_2.png" src="_images/san_guo2.png" /></p>
<ul class="simple">
<li><p>æˆ‘ä»¬å‘ç°æ¯ä¸€å›çš„é“¾æ¥åœ¨ç½‘é¡µä¸­çš„æ ‡ç­¾ ul é‡Œé¢ï¼Œå…·ä½“åœ¨å…¶æ¯ä¸ªå­æ ‡ç­¾ span ä¸­çš„å­æ ‡ç­¾ a é‡Œé¢ã€‚</p></li>
</ul>
<p>æ‰“å¼€å…¶ä¸­ä»»ä¸€å›çš„é“¾æ¥ï¼Œåœ¨ç½‘é¡µç©ºç™½å¤„å•å‡»å³é”®ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼š</p>
<p><img alt="sanguo_3.png" src="_images/san_guo3.png" /></p>
<ul class="simple">
<li><p>æˆ‘ä»¬å‘ç°æ¯ä¸€å›çš„å†…å®¹åœ¨å…·ä½“å±æ€§ä¸º class=â€™contsonâ€™ çš„ div æ ‡ç­¾é‡Œï¼Œå…¶ä¸­ç¬¬ä¸€å¥ä¸ºæ¯ä¸€å›çš„æ ‡é¢˜ï¼Œè€Œä¹‹åçš„å†…å®¹ä¸ºæ­£æ–‡ã€‚</p></li>
</ul>
<p>æ ¹æ®ç½‘é¡µçš„ä»¥ä¸Šä¸¤ä¸ªç‰¹ç‚¹ï¼Œè®¾è®¡ Python çš„çˆ¬è™«ä»£ç å¦‚ä¸‹ã€‚</p>
<div class="highlight-{code-block}python notranslate"><div class="highlight"><pre><span></span>import requests  # è”ç³»ç½‘ç»œçš„åŒ…ï¼Œa package for requesting from websites
from bs4 import BeautifulSoup  # åˆ†æç½‘é¡µæ•°æ®çš„åŒ…ï¼Œa package for webstie data analysis
import time
import random
import os


# è·å–å•ä¸ªç½‘é¡µä¿¡æ¯
def get_url_content(url):
    headers = {
        &#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36&#39;
    }  # ä¸»è¦æ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨ç™»å½•ï¼Œé˜²æ­¢åçˆ¬ï¼Œä¸€èˆ¬çš„ç½‘ç«™æ²¡æœ‰è¿™ä¸ªä¹Ÿè¡Œ
    r = requests.get(url, headers=headers, timeout=30)  # è·å–ç½‘é¡µçš„å†…å®¹ï¼Œå¹¶è¿”å›ç»™rå˜é‡ï¼Œtimeout ä¸ºè¶…æ—¶æ—¶é—´
    r.raise_for_status()  # æ£€æŸ¥è¿”å›ç½‘é¡µçš„å†…å®¹çš„çŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ
    r.encoding = r.apparent_encoding  # ç»Ÿä¸€ç¼–ç æ–¹å¼
    return r.text  # è¿”å›ç½‘é¡µä¸­çš„æ–‡æœ¬å†…å®¹ï¼Œæ•°æ®å†…å®¹ä¸º r.content


# è§£æå‡ºç½‘é¡µä¸­æƒ³è¦çš„ä¿¡æ¯ï¼Œçˆ¬è™«çš„å…³é”®æ­¥éª¤
def filter_info(chapter_num, url_text):
    soup = BeautifulSoup(url_text, &quot;lxml&quot;)  # è§£æç½‘é¡µè¿”å›å†…å®¹ï¼Œlxml æ˜¯ä¸€ä¸ªè§£ç æ–¹å¼ï¼Œæ•ˆç‡æ¯”è¾ƒå¿«ï¼Œè¢«æ¨èä½¿ç”¨
    contents = soup.find(&#39;div&#39;, class_=&#39;contson&#39;)
    # ä½¿ç”¨ get_text å¯ä»¥å®ç°ç½‘é¡µé‡Œé¢ p æ ‡ç­¾ä¸­æ–‡æœ¬å†…å®¹çš„æ¢è¡Œï¼Œè€Œ text ä¸èƒ½
    chapter_title = contents.find(&#39;p&#39;).get_text()  # ç¬¬ä¸€å¥è¯æ˜¯æœ¬å›çš„æ ‡é¢˜
    chapter_title = &#39;ç¬¬&#39; + str(chapter_num) + &#39;å› &#39; + chapter_title.lstrip()
    chapter_content = contents.get_text(separator=&quot;\n&quot;)  # find è¿”å›çš„ä¸æ˜¯åˆ—è¡¨ï¼Œä¸ç”¨è·Ÿ [0]
    chapter_content = chapter_content.lstrip() # ç»“æ‰å­—ç¬¦ä¸²å·¦è¾¹çš„ç©ºå­—ç¬¦
    this_chapter = [chapter_title, chapter_content]
    return this_chapter

# ä»ç½‘é¡µä¸­æ‰¾åˆ°æ¯ä¸€å›çš„é“¾æ¥
def get_url_links(url_head_content):
    soup = BeautifulSoup(url_head_content, &quot;lxml&quot;)  # è§£æç½‘é¡µè¿”å›å†…å®¹ï¼Œlxml æ˜¯ä¸€ä¸ªè§£ç æ–¹å¼ï¼Œæ•ˆç‡æ¯”è¾ƒå¿«ï¼Œè¢«æ¨èä½¿ç”¨
    # links = soup.find(&#39;div&#39;, class_=&#39;bookcont&#39;)  # æ¯ä¸€å›çš„é“¾æ¥éƒ½åœ¨ç±» span é‡Œé¢
    links = soup.find(&#39;ul&#39;)  # æ¯ä¸€å›çš„é“¾æ¥éƒ½åœ¨ç±» ul é‡Œé¢
    links = links.findAll(&#39;span&#39;)
    link_list = []
    for each in links:
        link_list.append(each.a.get(&#39;href&#39;))  # è·å–æ¯ä¸€å›çš„é“¾æ¥ï¼Œå­˜å‚¨åˆ°åˆ—è¡¨é‡Œ
    return link_list

# å°†æ¯ç« å†…å®¹è¾“å‡ºåˆ° txt æ–‡æ¡£é‡Œ
def write_txt(string_array):
    file_address = &#39;E:/ä¸‰å›½æ¼”ä¹‰/&#39;  # txt å­˜æ”¾åœ°å€
    if not os.path.exists(file_address):       #ç”¨osåº“åˆ¤æ–­å¯¹åº”æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨
        os.makedirs(file_address)              #å¦‚æœæ²¡æœ‰å¯¹åº”æ–‡ä»¶å¤¹åˆ™è‡ªåŠ¨ç”Ÿæˆ 
    file_name = string_array[0]
    with open(file_address + file_name + &#39;.txt&#39;, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f: # å¿…é¡»è·Ÿè§£ç å½¢å¼ï¼Œä¸ç„¶æœ‰çš„ç½‘é¡µä¸­æ–‡å†…å®¹å†™ä¸åˆ°txté‡Œ
        f.write(string_array[1])

# ä¸»å‡½æ•°
def main():
    url = &#39;https://so.gushiwen.cn/guwen/book_46653FD803893E4F7F702BCF1F7CCE17.aspx&#39;  # å¤è¯—æ–‡ç½‘ä¸‰å›½æ¼”ä¹‰ç½‘å€
    url_head_content = get_url_content(url)  # è·å–ç½‘é¡µ
    links = get_url_links(url_head_content)  # è·å–æ¯ä¸€å›çš„é“¾æ¥åœ°å€
    for index, each in enumerate(links):
        url_link_content = get_url_content(each)  # è·å–æ¯ä¸€å›çš„ç½‘é¡µå†…å®¹
        chapter_content = filter_info(index + 1, url_link_content)  # è§£ææ¯ä¸€å›çš„ç½‘é¡µå†…å®¹ï¼Œè·å–å°è¯´æ–‡æœ¬
        write_txt(chapter_content)  # è¾“å‡ºå°è¯´å†…å®¹åˆ° txt
        time.sleep(random.random() * 1)  # æ¯æŠ“ä¸€ä¸ªç½‘é¡µä¼‘æ¯0~1ç§’ï¼Œé˜²æ­¢è¢«åçˆ¬æªæ–½å°é” IP

# è¿è¡Œå‡½æ•°
main()
</pre></div>
</div>
<p>å…¶ä¸­ï¼Œä½¿ç”¨ requests åº“æ—¶ï¼Œæœ‰çš„ç½‘ç«™éœ€è¦è®¾ç½® headers å‚æ•°æ‰èƒ½æ­£ç¡®æ¨¡æ‹Ÿæµè§ˆå™¨ç™»å½•ã€‚headers å‚æ•°å¯ä»¥åœ¨æ‰“å¼€ç½‘é¡µæ—¶ï¼ŒæŒ‰é”®ç›˜<code class="docutils literal notranslate"><span class="pre">F12</span></code> æ‰“å¼€ï¼Œ ç„¶ååˆ·æ–°ä¸€ä¸‹ç½‘é¡µï¼Œå•å‡»<code class="docutils literal notranslate"><span class="pre">F12</span></code>å¼¹å‡ºçª—å£çš„ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±èƒ½æŸ¥çœ‹ç½‘ç«™çš„æ‰€æœ‰ headers ä¿¡æ¯ï¼Œæœ‰ cookieï¼Œuser-agent ç­‰ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="sanguo_4.png" src="_images/san_guo4.png" /></p>
<p>æˆ‘ä»¬å¯ä»¥å¤åˆ¶ä¸€éƒ¨åˆ†ä¿¡æ¯æˆ–å…¨éƒ¨ä¿¡æ¯ï¼Œæ”¾åˆ° request å‡½æ•°çš„ headers å‚æ•°é‡Œé¢ã€‚</p>
</section>
<section id="top-250">
<h2><span class="section-number">8.4. </span>çˆ¬è™«å®ä¾‹ 2ï¼šæŠ“è±†ç“£ top 250 çš„ç”µå½±ä¿¡æ¯<a class="headerlink" href="#top-250" title="Permalink to this headline">#</a></h2>
<p>æˆ‘ä»¬æƒ³è·å–è±†ç“£é«˜åˆ†è¯„ä»·çš„ 250 éƒ¨ç”µå½±çš„ä¿¡æ¯ï¼šç”µå½±åå­—ï¼Œå¯¼æ¼”ï¼Œä¸Šæ˜ å¹´ä»£ï¼Œè¯„åˆ†ï¼Œè¯„åˆ†äººæ•°ç­‰ã€‚æ‰“å¼€è±†ç“£ top 250 çš„ç½‘é¡µé“¾æ¥ https://movie.douban.com/top250?start= ï¼Œå‘ç°æ¯ä¸ªç½‘é¡µæ˜¾ç¤º 25 éƒ¨ç”µå½±ï¼Œä¸€å…±æœ‰ 10 ä¸ªæŒ–ç½‘é¡µï¼Œç½‘é¡µåœ°å€ä¸é“¾æ¥ä¸­çš„ start = åé¢çš„æ•°å­—æœ‰å…³ã€‚ä¾‹å¦‚ç¬¬ 3 ä¸ªå­ç½‘é¡µçš„é“¾æ¥åœ°å€æ˜¯ â€˜https://movie.douban.com/top250?start=50 ï¼Œæ ¹æ®è¿™ä¸ªè§„å¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª for å¾ªç¯ï¼Œå°† 10 ä¸ªç½‘é¡µåˆ†åˆ«æ‰“å¼€æŠ“å–ä¿¡æ¯ã€‚</p>
<p>æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œå•å‡»å³é”®æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="douban1.png" src="_images/douban1.png" /></p>
<p>é€šè¿‡æºä»£ç å‘ç°ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul class="simple">
<li><p>æ¯éƒ¨ç”µå½±çš„ä¿¡æ¯éƒ½åœ¨æ ‡ç­¾ &lt;div class=â€™itemâ€™&gt; é‡Œé¢ã€‚æ®æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª for å¾ªç¯ï¼Œå°†æ¯ä¸ªç½‘é¡µçš„  &lt;div class=â€™item&gt; æ ‡ç­¾éƒ½æ£€ç´¢å‡ºæ¥</p></li>
<li><p>ç”µå½±çš„ä¸­è‹±æ–‡åå­—éƒ½åœ¨æ ‡ç­¾  &lt;div class=â€™titleâ€™&gt; é‡Œï¼Œè€Œå…¶ä»–åå­—åœ¨æ ‡ç­¾ &lt;div class=â€™otherâ€™&gt; é‡Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°<code class="docutils literal notranslate"><span class="pre">find()</span></code>ä»¥åŠ<code class="docutils literal notranslate"><span class="pre">find_next()</span></code> æ£€ç´¢å‡ºæ¥ã€‚</p></li>
<li><p>å¯¼æ¼”ï¼Œä¸»æ¼”ï¼Œä¸Šæ˜ å¹´ä»£ï¼Œç”µå½±äº§åœ°ï¼Œç”µå½±ç±»å‹ä¿¡æ¯åœ¨æ ‡ç­¾ &lt;p class=â€™â€™&gt; é‡Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°<code class="docutils literal notranslate"><span class="pre">find()</span></code>æ£€ç´¢ï¼Œç„¶ååˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼å°†é‡Œé¢å¯¹åº”æ–‡æœ¬ä¿¡æ¯åˆ†åˆ«æå–å‡ºæ¥ã€‚</p></li>
<li><p>è¯„åˆ†ä¿¡æ¯åœ¨æ ‡ç­¾ &lt;div class=â€™rating_numâ€™&gt; é‡Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°<code class="docutils literal notranslate"><span class="pre">find()</span></code>æ£€ç´¢å‡ºæ¥ã€‚</p></li>
<li><p>è¯„åˆ†äººæ•°ä¿¡æ¯åœ¨æ ‡ç­¾ &lt;spanâ€™&gt; é‡Œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°<code class="docutils literal notranslate"><span class="pre">find()</span></code>ç»“åˆå…³é”®å­—â€™è¯„ä»·â€™æ£€ç´¢å‡ºæ¥ã€‚</p></li>
<li><p>ä»£è¡¨æ€§è¯„ä»·ä¿¡æ¯åœ¨æ ‡ç­¾ &lt;div class=â€™quoteâ€™&gt; é‡Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°<code class="docutils literal notranslate"><span class="pre">find()</span></code>æ£€ç´¢å‡ºæ¥ã€‚</p></li>
</ul>
<p>æ ¹æ®ä»¥ä¸Šçš„ç‰¹ç‚¹ï¼Œè®¾è®¡å‡ºä»¥ä¸‹çš„ python ä»£ç ã€‚å…¶ä¸­ä¸­æ–‡åˆ†è¯åº“<code class="docutils literal notranslate"><span class="pre">jieba</span></code>ï¼Œè¯äº‘åº“<code class="docutils literal notranslate"><span class="pre">WordCloud</span></code>åº“ç­‰ï¼Œè‹¥æ²¡æœ‰å®‰è£…ï¼Œéœ€è¦æå‰å®‰è£…ï¼ˆä½¿ç”¨ pip æˆ– conda å®‰è£…ï¼‰åˆ°ç”µè„‘ä¸Šã€‚</p>
<p>åœ¨ç”»å›¾æ—¶ï¼Œä½¿ç”¨ matplotlib ç”»å‡ºé¥¼å›¾ï¼Œä½¿ç”¨ WordCloud ç”Ÿæˆè¯äº‘å›¾ï¼Œå› ä¸º matplotlib ä¸èƒ½è‡ªåŠ¨å°†ä¸åŒæŸ±å­åˆ†é…ä¸åŒçš„é¢œè‰²ï¼Œä½¿ç”¨ seaborn ç”»å‡ºæŸ±çŠ¶å›¾ã€‚</p>
<div class="highlight-{code-block}python notranslate"><div class="highlight"><pre><span></span>import requests  # è”ç³»ç½‘ç»œçš„åŒ…ï¼Œa package for requesting from websites
import pandas as pd
from bs4 import BeautifulSoup # åˆ†æç½‘é¡µæ•°æ®çš„åŒ…ï¼Œa package for webstie data analysis
import matplotlib.pyplot as plt # ç”»å›¾çš„åŒ…
import time 
import random
import jieba # ä¸­æ–‡åˆ†è¯åŒ…
from wordcloud import WordCloud # è¯äº‘åŒ…
import re  # æ­£åˆ™è¡¨è¾¾å¼åŒ…
import seaborn as sns # ç”¨ seaborn ç”»æŸ±çŠ¶å›¾

plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] 

# ä¸»è¦æ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨ç™»å½•ï¼Œé˜²æ­¢åçˆ¬
headers = {
    &#39;user-agent&#39;:&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36&#39;
    }

## store the information
rank_list = []
name_list = [] # ç”¨æ¥å­˜å‚¨ç”µå½±åå­—çš„ä¸€ä¸ªäºŒç»´åˆ—è¡¨
director_list = [] # ç”¨æ¥å­˜å‚¨å¯¼æ¼”åå­—çš„ä¸€ä¸ªåˆ—è¡¨ï¼Œä¸‹é¢å‡ ä¸ªå˜é‡ç±»ä¼¼
actor_list = []
year_list = []
rating_list = []
ratingNum_list = []
quote_list = []
place_list = []
category_list = []

num = 0
for i in range(0, 10):
    link = &#39;https://movie.douban.com/top250?start=&#39; + str(i*25) # 250éƒ¨ç”µå½±ä¸€å…± 10ä¸ªç½‘é¡µï¼Œ 10 pages for total 250 movies    
    res = requests.get(link, headers = headers, timeout = 10)
    time.sleep(random.random()*3) # æ¯æŠ“ä¸€ä¸ªç½‘é¡µä¼‘æ¯2~3ç§’ï¼Œé˜²æ­¢è¢«åçˆ¬æªæ–½å°é” IPï¼Œavoid being blocked of the IP address
    
    # res.text is the content of the crawler
    soup = BeautifulSoup(res.text, &quot;lxml&quot;)  # lxml æ˜¯ä¸€ä¸ªè§£ç æ–¹å¼ï¼Œlxml is one decoding model for Beautifulsoup
    movie_list = soup.find_all(&#39;div&#39;, class_ = &#39;item&#39;) # æ£€ç´¢æ‰€æœ‰ç±»å‹ä¸º item çš„ div æ ‡ç­¾
    
    for each in movie_list:
        # æ’ååœ¨ em æ ‡ç­¾é‡Œ
        rank = each.em.text
        rank_list.append(rank)
        
        # ç”µå½±åå­—åœ¨æ ‡ç­¾ &lt;span class=&quot;title&quot;&gt; ä¸ &lt;span class=&quot;other&quot;&gt; é‡Œ
        other_name = each.find(&#39;span&#39;, class_ = &#39;other&#39;).get_text()
        other_name = other_name.replace(&#39; &#39;, &#39;&#39;) # å»æ‰ç©ºæ ¼
        other_name = other_name.replace(&#39;\xa0/\xa0&#39;, &#39;&#39;) # å»æ‰å¤šä½™å­—ç¬¦ \xa0/\xa0
        cn_name = each.find(&#39;span&#39;, class_ = &#39;title&#39;).get_text()
        eg_name = each.find(&#39;span&#39;, class_ = &#39;title&#39;).find_next().get_text() # find_next() æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„ä¸‹ä¸€ä¸ªæ ‡ç­¾
        eg_name = eg_name.replace(&#39;\xa0/\xa0&#39;, &#39;&#39;) # å»æ‰å¤šä½™å­—ç¬¦ \xa0/\xa0
        name_list.append([cn_name, eg_name, other_name])   
              
        # è¯„åˆ†ä¿¡æ¯åœ¨æ ‡ç­¾  &lt;span class=&quot;rating_num&quot;&gt; é‡Œ
        rating =  each.find(&#39;span&#39;, class_ = &#39;rating_num&#39;).get_text()
        rating_list.append(float(rating))
        
        # è¯„ä»·äººæ•°é€šè¿‡å…³é”®è¯&#39;è¯„ä»·&#39;æ£€ç´¢
        rating_num = each.find(string = re.compile(&#39;è¯„ä»·&#39;)).get_text()
        rating_num = rating_num.replace(&#39;äººè¯„ä»·&#39;, &#39;&#39;)
        ratingNum_list.append(int(rating_num))
        
        # ä»£è¡¨æ€§è¯„ä»·åœ¨  &lt;p class=&quot;quote&quot;&gt; é‡Œ  
        try:
            quote =  each.find(&#39;p&#39;, class_ = &#39;quote&#39;).get_text()
        except Exception: # æœ‰çš„ç”µå½±ä»£è¡¨æ€§è¯„ä»·æ²¡æœ‰æ˜¾ç¤º
            quote =  &#39;&#39;
        quote_list.append(quote)
        
        info = each.p.get_text(strip = True)
        # å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼æå–å‡ºå¯¼æ¼”ï¼Œä¸»æ¼”ï¼Œä¸Šæ˜ æ—¶é—´ï¼Œåœ°ç‚¹ï¼Œç”µå½±ç±»å‹ä¿¡æ¯        
        try: 
            # (?&lt;=å¯¼æ¼”: ) match any character begins after character &#39;å¯¼æ¼”: &#39;
            # .*? match any character (.), zero or more times (*) but as less as possible (?)
            # (?=ä¸») match any character before character &#39;ä¸»&#39;
            director = re.compile(&#39;(?&lt;=å¯¼æ¼”: ).*?(?=ä¸»)&#39;).findall(info)[0]
            actor = re.compile(&#39;(?&lt;=ä¸»æ¼”: ).*?(?=/)&#39;).findall(info)[0]
        except Exception: # æœ‰çš„ç”µå½±å¯¼æ¼”åå­—å¤ªé•¿ï¼Œä¸»æ¼”æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥
            director = re.compile(&#39;(?&lt;=å¯¼æ¼”: ).*?(?=\xa0)&#39;).findall(info)[0]
            actor = &#39;&#39;  
        director_list.append(director)
        actor_list.append(actor)
        
        # \d{4} is a four digit number
        year = re.compile(&#39;(?&lt;=...)\d{4}&#39;).findall(info)[0]
        year_list.append(year)
        place_category = re.compile(&#39;(?&lt;=\xa0/\xa0).*&#39;).findall(info)[0]
        place_category = place_category.replace(&#39;\xa0&#39;, &#39;&#39;)
        place_category = place_category.split(&#39;/&#39;)
        place = place_category[0]
        category = place_category[1]
        place_list.append(place)
        category_list.append(category)
          
# å°†æ•°æ®å­˜åˆ° pandas é‡Œ
df = pd.DataFrame(rank_list, columns = [&#39;æ’å&#39;])    
df[&#39;ç”µå½±åå­—&#39;] = [i[0] for i in name_list]
df[&#39;å¤–æ–‡åå­—&#39;] = [i[1] for i in name_list]
df[&#39;å…¶ä»–åå­—&#39;] = [i[2] for i in name_list]
df[&#39;è¯„åˆ†&#39;] = rating_list
df[&#39;è¯„ä»·äººæ•°&#39;] = ratingNum_list
df[&#39;å¯¼æ¼”&#39;] = director_list
df[&#39;ä¸»æ¼”&#39;] = actor_list
df[&#39;ä¸Šæ˜ æ—¥æœŸ&#39;] = year_list
df[&#39;åœ°åŒº&#39;] = place_list
df[&#39;ç±»å‹&#39;] = category_list
df[&#39;ä»£è¡¨æ€§è¯„è®º&#39;] = quote_list

# å¯¼å‡ºåˆ° xls æ–‡ä»¶é‡Œï¼Œsave to xls file    
df.to_csv(&#39;è±†ç“£ top 250 ç”µå½±çˆ¬è™«æŠ“å–.csv&#39;)

# åˆ†æç”µå½±æ¥æºåœ°å¹¶ç”»é¥¼å›¾
locations = []
for i in range(len(place_list)):
    nations = place_list[i].split(&#39; &#39;) 
    for j in range(len(nations)):
        if nations[j] == &#39;è¥¿å¾·&#39;:
            nations[j] = &#39;å¾·å›½&#39;
        locations.append(nations[j])

df_location = pd.DataFrame(locations, columns = [&#39;åœ°åŒº&#39;])
# æŒ‰ç…§å‡ºç°æ¬¡æ•°æ’åº, size() å¯ä»¥æŸ¥æ•°ï¼Œç”Ÿæˆä¸€ä¸ª Series ç±»å‹
# ç„¶åç”¨ reset_index é‡æ–°å‘½åï¼Œå‚æ•°ä¸º name
# DataFrame ç±»å‹çš„ reset_index å‚æ•°ä¸º names
df2 = df_location.groupby(&#39;åœ°åŒº&#39;).size().reset_index(name=&#39;counts&#39;) # df2 = df2[&#39;åœ°åŒº&#39;].value_counts(ascending = False).reset_index()
df2.sort_values(by = &#39;counts&#39;, ascending = False, inplace = True, ignore_index = True)
# ç”»é¥¼çŠ¶å›¾
values = []
labels = []
other_count = 0
for i in range(9):
    values.append(df2[&#39;counts&#39;][i])
    labels.append(df2[&#39;åœ°åŒº&#39;][i])
for i in range(9, df2.shape[0]):
    other_count += int(df2[&#39;counts&#39;][i])
values.append(other_count)
labels.append(&#39;å…¶ä»–åœ°åŒº&#39;)
plt.figure(1)
plt.pie(values, labels=labels, autopct=&#39;%.2f%%&#39;)
plt.legend()  # æ˜¾ç¤ºæ ‡ç­¾
plt.show()


# åˆ†æç”µå½±ç±»å‹å¹¶ç”»é¥¼å›¾
categories = []
for i in range(len(category_list)):
    category = category_list[i].split(&#39; &#39;) 
    for j in range(len(category)):
        categories.append(category[j])
        
df_category = pd.DataFrame(categories, columns = [&#39;ç±»å‹&#39;])    
df3 = df_category.groupby(&#39;ç±»å‹&#39;).size().reset_index(name=&#39;counts&#39;) 
df3.sort_values(by = &#39;counts&#39;, ascending = False, inplace = True, ignore_index = True)

values = []
labels = []
other_count = 0
for i in range(15):
    values.append(df3[&#39;counts&#39;][i])
    labels.append(df3[&#39;ç±»å‹&#39;][i])
for i in range(15, df3.shape[0]):
    other_count += int(df3[&#39;counts&#39;][i])
values.append(other_count)
labels.append(&#39;å…¶ä»–ç±»å‹&#39;)
plt.figure(2)
plt.pie(values, labels=labels, autopct=&#39;%.2f%%&#39;)
plt.legend()
plt.show()

# ç”»è¯äº‘å›¾
jieba.add_word(&#39;ä¹…çŸ³è®©&#39;)
jieba.add_word(&#39;è°¢è€³æœµ&#39;)
# ä¸€äº›è¯­æ°”è¯å’Œæ²¡æœ‰æ„ä¹‰çš„è¯
del_words = [ &#39;å°±æ˜¯&#39;, &#39;ä¸€ä¸ª&#39;, &#39;è¢«&#39;, &#39;ç”µå½±&#39;, &#39;æˆ‘ä»¬&#39;,
              &#39;ä¸æ˜¯&#39;, &#39;æ¯ä¸ª&#39;,  &#39;ä¸ä¼š&#39;,  &#39;æ²¡æœ‰&#39;, 
              &#39;è¿™æ ·&#39;, &#39;é‚£ä¹ˆ&#39;, &#39;ä¸è¦&#39;, &#39;å¦‚æœ&#39;,
              &#39;ä¸èƒ½&#39;,  &#39;ä¸€ç§&#39;, &#39;ä¸è¿‡&#39;, &#39;åªæœ‰&#39;, &#39;ä¸å¾—ä¸&#39;, 
              &#39;ä¸å¾—ä¸&#39;, &#39;ä¸€éƒ¨&#39;]
all_quotes = &#39;&#39;.join(quote_list) # å°†æ‰€æœ‰ä»£è¡¨æ€§è¯„è®ºæ‹¼æ¥ä¸ºä¸€ä¸ªæ–‡æœ¬
# å»æ‰æ ‡ç‚¹ç¬¦å·
all_quotes = re.sub(r&quot;[0-9\s+\.\!\/_,$%^*()?;ï¼›:-ã€ã€‘+\&quot;\&#39;]+|[+â€”â€”ï¼ï¼Œ;:ã€‚ï¼Ÿã€~@#ï¿¥%â€¦â€¦&amp;*ï¼ˆï¼‰]+&quot;, &quot; &quot;, all_quotes)
words = jieba.lcut(all_quotes)
words_final = []
for i in range(len(words)): 
    if len(words[i]) &gt; 1 and  words[i] not in del_words: # å»æ‰ä¸€äº›è¯­æ°”è¯ï¼Œå•å­—è¯ 
        words_final.append(words[i])
text_result = Counter(words_final)
cloud = WordCloud(
    font_path = &#39;C:\Windows\Fonts\FZSTK.TTF&#39;, # ä¸­æ–‡å­—ä½“åœ°å€ C:\Windows\Fonts\FZSTK.TTFï¼Œæå‰ä¸‹è½½å­—ä½“æˆ–æŒ‡å®šï¼Œå¦åˆ™ä¸­æ–‡æ— æ³•æ˜¾ç¤º
    # mask = &#39;&#39; é€šè¿‡ mask å‚æ•°æŒ‡å®šä¸€ä¸ªå›¾ç‰‡åœ°å€ä½œä¸ºè¯äº‘çš„èƒŒæ™¯å›¾åƒ 
    background_color = &#39;white&#39;,
    width = 1000,
    height = 860,
    max_words = 25   
  )
#wc = cloud.generate(words) # è¿™ç§æ–¹æ³•å¯¹ä¸­æ–‡æ”¯æŒä¸å¤ªå¥½ï¼Œthis mehtod is better for only english string
wc = cloud.generate_from_frequencies(text_result)
wc.to_file(&quot;è±†ç“£ TOP 250 è¯äº‘.jpg&quot;) 
plt.figure(3)
plt.imshow(wc)
plt.axis(&#39;off&#39;)
plt.title(&#39;è±†ç“£ TOP 250 ç”µå½±ä»£è¡¨æ€§è¯„è®ºçš„è¯äº‘åˆ†æ&#39;)
plt.show()

# è¯„åˆ†æœ€é«˜çš„ 15 éƒ¨ç”µå½±
# ç”¨ seaborn ç”»æŸ±çŠ¶å›¾ï¼Œå› ä¸ºè‡ªåŠ¨å°†ä¸åŒæŸ±å­åˆ†é…ä¸åŒçš„é¢œè‰²
df_star = df.sort_values(by = &#39;è¯„åˆ†&#39;, ascending = False, ignore_index = True)
number = 15
df_star_top = df_star.head(number)
plt.figure(4)
sns.barplot(data = df_star_top, y = &#39;ç”µå½±åå­—&#39;, x = &#39;è¯„åˆ†&#39;, orient = &#39;h&#39;)
plt.title(&#39;è¯„åˆ†æœ€é«˜çš„ &#39; + str(number) + &#39; éƒ¨ç”µå½±&#39;)
plt.show()

# è¯„åˆ†äººæ•°æœ€å¤šçš„ 15 éƒ¨ç”µå½±
df_num = df.sort_values(by = &#39;è¯„ä»·äººæ•°&#39;, ascending = False, ignore_index = True)
df_num_top = df_num.head(number)
plt.figure(5)
sns.barplot(data = df_num_top, y = &#39;ç”µå½±åå­—&#39;, x = &#39;è¯„ä»·äººæ•°&#39;, orient = &#39;h&#39;)
plt.title(&#39;è¯„åˆ†äººæ•°æœ€å¤šçš„ &#39; + str(number) + &#39; éƒ¨ç”µå½±&#39;)
plt.show()

# ç”µå½±å¹´ä»£ç”»å›¾
df_year = df.groupby(&#39;ä¸Šæ˜ æ—¥æœŸ&#39;).size().reset_index(name = &#39;éƒ¨æ•°&#39;)
df_year.sort_values(&#39;éƒ¨æ•°&#39;, ascending = False, inplace = True)
df_year_top = df_year.head(20)
df_year_top.sort_values(&#39;ä¸Šæ˜ æ—¥æœŸ&#39;, inplace = True)
plt.figure(6)
sns.barplot(data = df_year_top, x = &#39;ä¸Šæ˜ æ—¥æœŸ&#39;, y = &#39;éƒ¨æ•°&#39;)
plt.title(&#39;ç”µå½±ä¸Šæ˜ å¹´ä»£&#39;)
plt.show()
</pre></div>
</div>
<p>ç”Ÿæˆçš„å›¾å½¢å¦‚ä¸‹ï¼š</p>
<p><img alt="douban2.png" src="_images/douban2.png" />
<img alt="douban3.png" src="_images/douban3.png" />
<img alt="douban4.png" src="_images/douban4.png" />
<img alt="douban5.png" src="_images/douban5.png" />
<img alt="douban6.png" src="_images/douban6.png" />
<img alt="douban7.png" src="_images/douban7.png" /></p>
<p>ä¸åŒçš„ç½‘ç«™çš„çˆ¬è™«æŠ€å·§ç»å¸¸ä¸ä¸€æ ·ï¼Œè¦å…·ä½“ç½‘ç«™å…·ä½“åˆ†æã€‚è¿‘å¹´æ¥ï¼Œè®¸å¤šç½‘ç«™éƒ½æé«˜äº†åçˆ¬æ‰‹æ®µé˜²æ­¢ç½‘ç«™çš„æ•°æ®è¢«æ— ç«¯è·å–ã€‚å› æ­¤ï¼Œæé†’è¯»è€…é¿å…è¿‡åº¦ä½¿ç”¨çˆ¬è™«ï¼Œç»™ä¸€äº›ç½‘ç«™é€ æˆä¸å¿…è¦çš„è®¿é—®è´Ÿæ‹…ã€‚</p>
</section>
<section id="id2">
<h2><span class="section-number">8.5. </span>ç»ƒä¹ <a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<div class="exercise admonition" id="crab-news">

<p class="admonition-title"><span class="caption-number">Exercise 8.1 </span></p>
<section id="exercise-content">
<p>ç»ƒä¹ æŠ“å–å­¦æ ¡çš„æ–°é—»ï¼Œå¹¶å°è¯•ç”»å‡ºè¯äº‘å›¾ã€‚</p>
</section>
</div>
<div class="exercise admonition" id="crab-çº¢æ¥¼">

<p class="admonition-title"><span class="caption-number">Exercise 8.2 </span></p>
<section id="exercise-content">
<p>å°è¯•ç”¨çˆ¬è™«ä¸‹è½½çº¢æ¥¼æ¢¦åˆ°ç”µè„‘é‡Œã€‚</p>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="draw-pictures.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Python ç”»å›¾</p>
      </div>
    </a>
    <a class="right-next"
       href="line-regression.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>çº¿æ€§å›å½’</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requests">8.1. <code class="docutils literal notranslate"><span class="pre">requests</span></code> åº“</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beautifulsoup4">8.2. <code class="docutils literal notranslate"><span class="pre">beautifulsoup4</span></code>åº“</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">8.3. çˆ¬è™«å®ä¾‹ 1ï¼šæŠ“å°è¯´</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#top-250">8.4. çˆ¬è™«å®ä¾‹ 2ï¼šæŠ“è±†ç“£ top 250 çš„ç”µå½±ä¿¡æ¯</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">8.5. ç»ƒä¹ </a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Zhen Chen
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>