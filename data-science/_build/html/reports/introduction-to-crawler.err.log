Traceback (most recent call last):
  File "D:\Users\chen_\anaconda3\Lib\site-packages\jupyter_cache\executors\utils.py", line 58, in single_nb_execution
    executenb(
  File "D:\Users\chen_\anaconda3\Lib\site-packages\nbclient\client.py", line 1204, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Users\chen_\anaconda3\Lib\site-packages\nbclient\util.py", line 84, in wrapped
    return just_run(coro(*args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Users\chen_\anaconda3\Lib\site-packages\nbclient\util.py", line 62, in just_run
    return loop.run_until_complete(coro)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Users\chen_\anaconda3\Lib\asyncio\base_events.py", line 653, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "D:\Users\chen_\anaconda3\Lib\site-packages\nbclient\client.py", line 663, in async_execute
    await self.async_execute_cell(
  File "D:\Users\chen_\anaconda3\Lib\site-packages\nbclient\client.py", line 965, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "D:\Users\chen_\anaconda3\Lib\site-packages\nbclient\client.py", line 862, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
```{code-block}python
import requests  # è”ç³»ç½‘ç»œçš„åŒ…ï¼Œa package for requesting from websites
import pandas as pd
from bs4 import BeautifulSoup # åˆ†æç½‘é¡µæ•°æ®çš„åŒ…ï¼Œa package for webstie data analysis
import matplotlib.pyplot as plt # ç”»å›¾çš„åŒ…
import time 
import random
import jieba # ä¸­æ–‡åˆ†è¯åŒ…
from wordcloud import WordCloud # è¯äº‘åŒ…
import re  # æ­£åˆ™è¡¨è¾¾å¼åŒ…
import seaborn as sns # ç”¨ seaborn ç”»æŸ±çŠ¶å›¾

plt.rcParams['font.sans-serif'] = ['SimHei'] 

# ä¸»è¦æ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨ç™»å½•ï¼Œé˜²æ­¢åçˆ¬
headers = {
    'user-agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36'
    }

## store the information
rank_list = []
name_list = [] # ç”¨æ¥å­˜å‚¨ç”µå½±åå­—çš„ä¸€ä¸ªäºŒç»´åˆ—è¡¨
director_list = [] # ç”¨æ¥å­˜å‚¨å¯¼æ¼”åå­—çš„ä¸€ä¸ªåˆ—è¡¨ï¼Œä¸‹é¢å‡ ä¸ªå˜é‡ç±»ä¼¼
actor_list = []
year_list = []
rating_list = []
ratingNum_list = []
quote_list = []
place_list = []
category_list = []

num = 0
for i in range(0, 10):
    link = 'https://movie.douban.com/top250?start=' + str(i*25) # 250éƒ¨ç”µå½±ä¸€å…± 10ä¸ªç½‘é¡µï¼Œ 10 pages for total 250 movies    
    res = requests.get(link, headers = headers, timeout = 10)
    time.sleep(random.random()*3) # æ¯æŠ“ä¸€ä¸ªç½‘é¡µä¼‘æ¯2~3ç§’ï¼Œé˜²æ­¢è¢«åçˆ¬æªæ–½å°é” IPï¼Œavoid being blocked of the IP address
    
    # res.text is the content of the crawler
    soup = BeautifulSoup(res.text, "lxml")  # lxml æ˜¯ä¸€ä¸ªè§£ç æ–¹å¼ï¼Œlxml is one decoding model for Beautifulsoup
    movie_list = soup.find_all('div', class_ = 'item') # æ£€ç´¢æ‰€æœ‰ç±»å‹ä¸º item çš„ div æ ‡ç­¾
    
    for each in movie_list:
        # æ’ååœ¨ em æ ‡ç­¾é‡Œ
        rank = each.em.text
        rank_list.append(rank)
        
        # ç”µå½±åå­—åœ¨æ ‡ç­¾ <span class="title"> ä¸ <span class="other"> é‡Œ
        other_name = each.find('span', class_ = 'other').get_text()
        other_name = other_name.replace(' ', '') # å»æ‰ç©ºæ ¼
        other_name = other_name.replace('\xa0/\xa0', '') # å»æ‰å¤šä½™å­—ç¬¦ \xa0/\xa0
        cn_name = each.find('span', class_ = 'title').get_text()
        eg_name = each.find('span', class_ = 'title').find_next().get_text() # find_next() æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„ä¸‹ä¸€ä¸ªæ ‡ç­¾
        eg_name = eg_name.replace('\xa0/\xa0', '') # å»æ‰å¤šä½™å­—ç¬¦ \xa0/\xa0
        name_list.append([cn_name, eg_name, other_name])   
              
        # è¯„åˆ†ä¿¡æ¯åœ¨æ ‡ç­¾  <span class="rating_num"> é‡Œ
        rating =  each.find('span', class_ = 'rating_num').get_text()
        rating_list.append(float(rating))
        
        # è¯„ä»·äººæ•°é€šè¿‡å…³é”®è¯'è¯„ä»·'æ£€ç´¢
        rating_num = each.find(string = re.compile('è¯„ä»·')).get_text()
        rating_num = rating_num.replace('äººè¯„ä»·', '')
        ratingNum_list.append(int(rating_num))
        
        # ä»£è¡¨æ€§è¯„ä»·åœ¨  <p class="quote"> é‡Œ  
        try:
            quote =  each.find('p', class_ = 'quote').get_text()
        except Exception: # æœ‰çš„ç”µå½±ä»£è¡¨æ€§è¯„ä»·æ²¡æœ‰æ˜¾ç¤º
            quote =  ''
        quote_list.append(quote)
        
        info = each.p.get_text(strip = True)
        # å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼æå–å‡ºå¯¼æ¼”ï¼Œä¸»æ¼”ï¼Œä¸Šæ˜ æ—¶é—´ï¼Œåœ°ç‚¹ï¼Œç”µå½±ç±»å‹ä¿¡æ¯        
        try: 
            # (?<=å¯¼æ¼”: ) match any character begins after character 'å¯¼æ¼”: '
            # .*? match any character (.), zero or more times (*) but as less as possible (?)
            # (?=ä¸») match any character before character 'ä¸»'
            director = re.compile('(?<=å¯¼æ¼”: ).*?(?=ä¸»)').findall(info)[0]
            actor = re.compile('(?<=ä¸»æ¼”: ).*?(?=/)').findall(info)[0]
        except Exception: # æœ‰çš„ç”µå½±å¯¼æ¼”åå­—å¤ªé•¿ï¼Œä¸»æ¼”æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥
            director = re.compile('(?<=å¯¼æ¼”: ).*?(?=\xa0)').findall(info)[0]
            actor = ''  
        director_list.append(director)
        actor_list.append(actor)
        
        # \d{4} is a four digit number
        year = re.compile('(?<=...)\d{4}').findall(info)[0]
        year_list.append(year)
        place_category = re.compile('(?<=\xa0/\xa0).*').findall(info)[0]
        place_category = place_category.replace('\xa0', '')
        place_category = place_category.split('/')
        place = place_category[0]
        category = place_category[1]
        place_list.append(place)
        category_list.append(category)
          
# å°†æ•°æ®å­˜åˆ° pandas é‡Œ
df = pd.DataFrame(rank_list, columns = ['æ’å'])    
df['ç”µå½±åå­—'] = [i[0] for i in name_list]
df['å¤–æ–‡åå­—'] = [i[1] for i in name_list]
df['å…¶ä»–åå­—'] = [i[2] for i in name_list]
df['è¯„åˆ†'] = rating_list
df['è¯„ä»·äººæ•°'] = ratingNum_list
df['å¯¼æ¼”'] = director_list
df['ä¸»æ¼”'] = actor_list
df['ä¸Šæ˜ æ—¥æœŸ'] = year_list
df['åœ°åŒº'] = place_list
df['ç±»å‹'] = category_list
df['ä»£è¡¨æ€§è¯„è®º'] = quote_list

# å¯¼å‡ºåˆ° xls æ–‡ä»¶é‡Œï¼Œsave to xls file    
df.to_csv('è±†ç“£ top 250 ç”µå½±çˆ¬è™«æŠ“å–.csv')

# åˆ†æç”µå½±æ¥æºåœ°å¹¶ç”»é¥¼å›¾
locations = []
for i in range(len(place_list)):
    nations = place_list[i].split(' ') 
    for j in range(len(nations)):
        if nations[j] == 'è¥¿å¾·':
            nations[j] = 'å¾·å›½'
        locations.append(nations[j])

df_location = pd.DataFrame(locations, columns = ['åœ°åŒº'])
# æŒ‰ç…§å‡ºç°æ¬¡æ•°æ’åº, size() å¯ä»¥æŸ¥æ•°ï¼Œç”Ÿæˆä¸€ä¸ª Series ç±»å‹
# ç„¶åç”¨ reset_index é‡æ–°å‘½åï¼Œå‚æ•°ä¸º name
# DataFrame ç±»å‹çš„ reset_index å‚æ•°ä¸º names
df2 = df_location.groupby('åœ°åŒº').size().reset_index(name='counts') # df2 = df2['åœ°åŒº'].value_counts(ascending = False).reset_index()
df2.sort_values(by = 'counts', ascending = False, inplace = True, ignore_index = True)
# ç”»é¥¼çŠ¶å›¾
values = []
labels = []
other_count = 0
for i in range(9):
    values.append(df2['counts'][i])
    labels.append(df2['åœ°åŒº'][i])
for i in range(9, df2.shape[0]):
    other_count += int(df2['counts'][i])
values.append(other_count)
labels.append('å…¶ä»–åœ°åŒº')
plt.figure(1)
plt.pie(values, labels=labels, autopct='%.2f%%')
plt.legend()  # æ˜¾ç¤ºæ ‡ç­¾
plt.show()


# åˆ†æç”µå½±ç±»å‹å¹¶ç”»é¥¼å›¾
categories = []
for i in range(len(category_list)):
    category = category_list[i].split(' ') 
    for j in range(len(category)):
        categories.append(category[j])
        
df_category = pd.DataFrame(categories, columns = ['ç±»å‹'])    
df3 = df_category.groupby('ç±»å‹').size().reset_index(name='counts') 
df3.sort_values(by = 'counts', ascending = False, inplace = True, ignore_index = True)

values = []
labels = []
other_count = 0
for i in range(15):
    values.append(df3['counts'][i])
    labels.append(df3['ç±»å‹'][i])
for i in range(15, df3.shape[0]):
    other_count += int(df3['counts'][i])
values.append(other_count)
labels.append('å…¶ä»–ç±»å‹')
plt.figure(2)
plt.pie(values, labels=labels, autopct='%.2f%%')
plt.legend()
plt.show()

# ç”»è¯äº‘å›¾
jieba.add_word('ä¹…çŸ³è®©')
jieba.add_word('è°¢è€³æœµ')
# ä¸€äº›è¯­æ°”è¯å’Œæ²¡æœ‰æ„ä¹‰çš„è¯
del_words = [ 'å°±æ˜¯', 'ä¸€ä¸ª', 'è¢«', 'ç”µå½±', 'æˆ‘ä»¬',
              'ä¸æ˜¯', 'æ¯ä¸ª',  'ä¸ä¼š',  'æ²¡æœ‰', 
              'è¿™æ ·', 'é‚£ä¹ˆ', 'ä¸è¦', 'å¦‚æœ',
              'ä¸èƒ½',  'ä¸€ç§', 'ä¸è¿‡', 'åªæœ‰', 'ä¸å¾—ä¸', 
              'ä¸å¾—ä¸', 'ä¸€éƒ¨']
all_quotes = ''.join(quote_list) # å°†æ‰€æœ‰ä»£è¡¨æ€§è¯„è®ºæ‹¼æ¥ä¸ºä¸€ä¸ªæ–‡æœ¬
# å»æ‰æ ‡ç‚¹ç¬¦å·
all_quotes = re.sub(r"[0-9\s+\.\!\/_,$%^*()?;ï¼›:-ã€ã€‘+\"\']+|[+â€”â€”ï¼ï¼Œ;:ã€‚ï¼Ÿã€~@#ï¿¥%â€¦â€¦&*ï¼ˆï¼‰]+", " ", all_quotes)
words = jieba.lcut(all_quotes)
words_final = []
for i in range(len(words)): 
    if len(words[i]) > 1 and  words[i] not in del_words: # å»æ‰ä¸€äº›è¯­æ°”è¯ï¼Œå•å­—è¯ 
        words_final.append(words[i])
text_result = Counter(words_final)
cloud = WordCloud(
    font_path = 'C:\Windows\Fonts\FZSTK.TTF', # ä¸­æ–‡å­—ä½“åœ°å€ C:\Windows\Fonts\FZSTK.TTFï¼Œæå‰ä¸‹è½½å­—ä½“æˆ–æŒ‡å®šï¼Œå¦åˆ™ä¸­æ–‡æ— æ³•æ˜¾ç¤º
    # mask = '' é€šè¿‡ mask å‚æ•°æŒ‡å®šä¸€ä¸ªå›¾ç‰‡åœ°å€ä½œä¸ºè¯äº‘çš„èƒŒæ™¯å›¾åƒ 
    background_color = 'white',
    width = 1000,
    height = 860,
    max_words = 25   
  )
#wc = cloud.generate(words) # è¿™ç§æ–¹æ³•å¯¹ä¸­æ–‡æ”¯æŒä¸å¤ªå¥½ï¼Œthis mehtod is better for only english string
wc = cloud.generate_from_frequencies(text_result)
wc.to_file("è±†ç“£ TOP 250 è¯äº‘.jpg") 
plt.figure(3)
plt.imshow(wc)
plt.axis('off')
plt.title('è±†ç“£ TOP 250 ç”µå½±ä»£è¡¨æ€§è¯„è®ºçš„è¯äº‘åˆ†æ')
plt.show()

# è¯„åˆ†æœ€é«˜çš„ 15 éƒ¨ç”µå½±
# ç”¨ seaborn ç”»æŸ±çŠ¶å›¾ï¼Œå› ä¸ºè‡ªåŠ¨å°†ä¸åŒæŸ±å­åˆ†é…ä¸åŒçš„é¢œè‰²
df_star = df.sort_values(by = 'è¯„åˆ†', ascending = False, ignore_index = True)
number = 15
df_star_top = df_star.head(number)
plt.figure(4)
sns.barplot(data = df_star_top, y = 'ç”µå½±åå­—', x = 'è¯„åˆ†', orient = 'h')
plt.title('è¯„åˆ†æœ€é«˜çš„ ' + str(number) + ' éƒ¨ç”µå½±')
plt.show()

# è¯„åˆ†äººæ•°æœ€å¤šçš„ 15 éƒ¨ç”µå½±
df_num = df.sort_values(by = 'è¯„ä»·äººæ•°', ascending = False, ignore_index = True)
df_num_top = df_num.head(number)
plt.figure(5)
sns.barplot(data = df_num_top, y = 'ç”µå½±åå­—', x = 'è¯„ä»·äººæ•°', orient = 'h')
plt.title('è¯„åˆ†äººæ•°æœ€å¤šçš„ ' + str(number) + ' éƒ¨ç”µå½±')
plt.show()

# ç”µå½±å¹´ä»£ç”»å›¾
df_year = df.groupby('ä¸Šæ˜ æ—¥æœŸ').size().reset_index(name = 'éƒ¨æ•°')
df_year.sort_values('éƒ¨æ•°', ascending = False, inplace = True)
df_year_top = df_year.head(20)
df_year_top.sort_values('ä¸Šæ˜ æ—¥æœŸ', inplace = True)
plt.figure(6)
sns.barplot(data = df_year_top, x = 'ä¸Šæ˜ æ—¥æœŸ', y = 'éƒ¨æ•°')
plt.title('ç”µå½±ä¸Šæ˜ å¹´ä»£')
plt.show()
```
------------------

[1;36m  Cell [1;32mIn[28], line 1[1;36m[0m
[1;33m    ```{code-block}python[0m
[1;37m    ^[0m
[1;31mSyntaxError[0m[1;31m:[0m invalid syntax

SyntaxError: invalid syntax (3294229199.py, line 1)

