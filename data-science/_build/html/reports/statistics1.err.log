Traceback (most recent call last):
  File "/opt/anaconda3/lib/python3.12/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/opt/anaconda3/lib/python3.12/site-packages/nbclient/client.py", line 1305, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/asyncio/base_events.py", line 685, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/opt/anaconda3/lib/python3.12/site-packages/nbclient/client.py", line 705, in async_execute
    await self.async_execute_cell(
  File "/opt/anaconda3/lib/python3.12/site-packages/nbclient/client.py", line 1058, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/opt/anaconda3/lib/python3.12/site-packages/nbclient/client.py", line 914, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# -*- coding: utf-8 -*-
"""
å®Œæ•´ç»“æ„æ–¹ç¨‹æ¨¡å‹ï¼ˆSEMï¼‰åˆ†æç¤ºä¾‹ï¼šç¤¾äº¤åª’ä½“å¹¿å‘Šå¯¹è´­ä¹°æ„æ„¿çš„å½±å“
åŒ…å«ï¼šæµ‹é‡æ¨¡å‹ã€ç»“æ„æ¨¡å‹ã€ä¸­ä»‹æ•ˆåº”ã€è°ƒèŠ‚æ•ˆåº”ï¼ˆå¤šç¾¤ç»„åˆ†æï¼‰
"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from semopy import Model, bootstrap, calc_lrtest
from semopy.semplot import semplot

# ======================
# 1. æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ
# ======================
np.random.seed(123)
n = 300  # æ ·æœ¬é‡

# æ½œå˜é‡çœŸå®å¾—åˆ†ï¼ˆç”¨äºç”Ÿæˆé¢˜é¡¹ï¼‰
latent_ad = np.random.normal(5, 1, n)    # å¹¿å‘Šå¸å¼•åŠ›æ½œå˜é‡
latent_trust = 0.6 * latent_ad + np.random.normal(0, 1, n)  # å“ç‰Œä¿¡ä»»ï¼ˆå—å¹¿å‘Šå½±å“ï¼‰
latent_purchase = 0.7 * latent_trust + 0.3 * latent_ad + np.random.normal(0, 1, n)  # è´­ä¹°æ„æ„¿

# ç”Ÿæˆè§‚æµ‹é¢˜é¡¹ï¼ˆå¸¦æµ‹é‡è¯¯å·®ï¼‰
data = pd.DataFrame({
    # å¹¿å‘Šå¸å¼•åŠ›é¢˜é¡¹ï¼ˆ3ä¸ªï¼‰
    'ad1': latent_ad + np.random.normal(0, 0.5, n),
    'ad2': latent_ad + np.random.normal(0, 0.5, n),
    'ad3': latent_ad + np.random.normal(0, 0.5, n),
    
    # å“ç‰Œä¿¡ä»»é¢˜é¡¹ï¼ˆ3ä¸ªï¼‰
    'trust1': latent_trust + np.random.normal(0, 0.5, n),
    'trust2': latent_trust + np.random.normal(0, 0.5, n),
    'trust3': latent_trust + np.random.normal(0, 0.5, n),
    
    # è´­ä¹°æ„æ„¿é¢˜é¡¹ï¼ˆ2ä¸ªï¼‰
    'purchase1': latent_purchase + np.random.normal(0, 0.5, n),
    'purchase2': latent_purchase + np.random.normal(0, 0.5, n),
    
    # è°ƒèŠ‚å˜é‡ï¼ˆä¸ªäººåˆ›æ–°æ€§ï¼Œ0=ä½ï¼Œ1=é«˜ï¼‰
    'group': np.random.binomial(1, 0.5, n)  # éšæœºåˆ†ç»„
})

# ======================
# 2. å®šä¹‰SEMæ¨¡å‹
# ======================
model_spec = '''
    # æµ‹é‡æ¨¡å‹ï¼ˆCFAéƒ¨åˆ†ï¼‰
    å¹¿å‘Šå¸å¼•åŠ› =~ ad1 + ad2 + ad3
    å“ç‰Œä¿¡ä»» =~ trust1 + trust2 + trust3
    è´­ä¹°æ„æ„¿ =~ purchase1 + purchase2
    
    # ç»“æ„æ¨¡å‹ï¼ˆè·¯å¾„åˆ†æï¼‰
    å“ç‰Œä¿¡ä»» ~ å¹¿å‘Šå¸å¼•åŠ›
    è´­ä¹°æ„æ„¿ ~ å“ç‰Œä¿¡ä»» + å¹¿å‘Šå¸å¼•åŠ›
'''

# ======================
# 3. æ¨¡å‹æ‹Ÿåˆä¸ç»“æœ
# ======================
model = Model(model_spec)
result = model.fit(data)
print("=== æ¨¡å‹æ‹Ÿåˆç»“æœ ===")
print(result)
print("\n=== æ ‡å‡†åŒ–ç³»æ•° ===")
print(model.inspect(std_est=True))

# ======================
# 4. ä¸­ä»‹æ•ˆåº”æ£€éªŒï¼ˆBootstrapï¼‰
# ======================
mediation_spec = '''
    å¹¿å‘Šå¸å¼•åŠ› =~ ad1 + ad2 + ad3
    å“ç‰Œä¿¡ä»» =~ trust1 + trust2 + trust3
    è´­ä¹°æ„æ„¿ =~ purchase1 + purchase2
    
    # å‘½åè·¯å¾„ç³»æ•°
    å“ç‰Œä¿¡ä»» ~ a*å¹¿å‘Šå¸å¼•åŠ›
    è´­ä¹°æ„æ„¿ ~ b*å“ç‰Œä¿¡ä»» + c*å¹¿å‘Šå¸å¼•åŠ›
    
    # å®šä¹‰æ•ˆåº”
    é—´æ¥ := a*b
    æ€»æ•ˆåº” := c + a*b
'''

mediation_model = Model(mediation_spec)
mediation_model.fit(data)
bootstrap_results = bootstrap(mediation_model, data, n=1000)

print("\n=== ä¸­ä»‹æ•ˆåº” ===")
print(f"é—´æ¥æ•ˆåº”ä¼°è®¡å€¼: {bootstrap_results['indirect'].mean():.3f}")
print(f"95%ç½®ä¿¡åŒºé—´: [{np.percentile(bootstrap_results['indirect'], 2.5):.3f}, "
      f"{np.percentile(bootstrap_results['indirect'], 97.5):.3f}]")

# ======================
# 5. è°ƒèŠ‚æ•ˆåº”åˆ†æï¼ˆå¤šç¾¤ç»„ï¼‰
# ======================
# æŒ‰è°ƒèŠ‚å˜é‡åˆ†ç»„
group0 = data[data['group'] == 0]  # ä½åˆ›æ–°æ€§ç»„
group1 = data[data['group'] == 1]  # é«˜åˆ›æ–°æ€§ç»„

# åˆ†åˆ«æ‹Ÿåˆæ¨¡å‹
model_group0 = Model(model_spec).fit(group0)
model_group1 = Model(model_spec).fit(group1)

# æå–å…³é”®è·¯å¾„ç³»æ•°
beta_group0 = model_group0.inspect().loc['å“ç‰Œä¿¡ä»»~å¹¿å‘Šå¸å¼•åŠ›', 'Estimate']
beta_group1 = model_group1.inspect().loc['å“ç‰Œä¿¡ä»»~å¹¿å‘Šå¸å¼•åŠ›', 'Estimate']

print("\n=== è°ƒèŠ‚æ•ˆåº” ===")
print(f"ä½åˆ›æ–°æ€§ç»„è·¯å¾„ç³»æ•°: {beta_group0:.3f}")
print(f"é«˜åˆ›æ–°æ€§ç»„è·¯å¾„ç³»æ•°: {beta_group1:.3f}")

# ä¼¼ç„¶æ¯”æ£€éªŒï¼ˆæ¯”è¾ƒä¸¤ç»„æ¨¡å‹ï¼‰
lrtest = calc_lrtest(model_group0, model_group1)
print(f"è·¯å¾„ç³»æ•°å·®å¼‚æ˜¾è‘—æ€§(på€¼): {lrtest.pvalue:.4f}")

# ======================
# 6. å¯è§†åŒ–
# ======================
# ç»˜åˆ¶è·¯å¾„å›¾ï¼ˆéœ€å®‰è£…graphvizï¼‰
plt.figure(figsize=(10, 6))
semplot(model, "model.png", plot_covs=True, show=True)

# ç»˜åˆ¶è°ƒèŠ‚æ•ˆåº”å›¾
plt.figure(figsize=(8, 5))
groups = ['ä½åˆ›æ–°æ€§', 'é«˜åˆ›æ–°æ€§']
coefs = [beta_group0, beta_group1]
plt.bar(groups, coefs, color=['skyblue', 'salmon'])
plt.title("å¹¿å‘Šå¸å¼•åŠ›â†’å“ç‰Œä¿¡ä»»çš„è°ƒèŠ‚æ•ˆåº”")
plt.ylabel("è·¯å¾„ç³»æ•°")
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

------------------


[0;31m---------------------------------------------------------------------------[0m
[0;31mImportError[0m                               Traceback (most recent call last)
Cell [0;32mIn[33], line 10[0m
[1;32m      8[0m [38;5;28;01mimport[39;00m [38;5;21;01mpandas[39;00m [38;5;28;01mas[39;00m [38;5;21;01mpd[39;00m
[1;32m      9[0m [38;5;28;01mimport[39;00m [38;5;21;01mmatplotlib[39;00m[38;5;21;01m.[39;00m[38;5;21;01mpyplot[39;00m [38;5;28;01mas[39;00m [38;5;21;01mplt[39;00m
[0;32m---> 10[0m [38;5;28;01mfrom[39;00m [38;5;21;01msemopy[39;00m [38;5;28;01mimport[39;00m Model, bootstrap, calc_lrtest
[1;32m     11[0m [38;5;28;01mfrom[39;00m [38;5;21;01msemopy[39;00m[38;5;21;01m.[39;00m[38;5;21;01msemplot[39;00m [38;5;28;01mimport[39;00m semplot
[1;32m     13[0m [38;5;66;03m# ======================[39;00m
[1;32m     14[0m [38;5;66;03m# 1. æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ[39;00m
[1;32m     15[0m [38;5;66;03m# ======================[39;00m

[0;31mImportError[0m: cannot import name 'bootstrap' from 'semopy' (/opt/anaconda3/lib/python3.12/site-packages/semopy/__init__.py)

